<!DOCTYPE html>
<meta charset="utf-8">
<html>
  <head>
    <script src="d3.v3.min.js"></script>
    <script src="d3sparql.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.0/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.3.0/dist/leaflet.js"></script>
    
    <script>

      //クエリを入力
      var endpoint = "http://dbpedia.org/sparql";
      var sparql = "PREFIX geo:  <http://www.w3.org/2003/01/geo/wgs84_pos#>"+
        "PREFIX foaf: <http://xmlns.com/foaf/0.1/>"+
        "PREFIX dbo: <http://dbpedia.org/ontology/>"+
        
        "select distinct ?name ?lat ?long where {"+
          "?s rdf:type dbo:WorldHeritageSite."+
          "?s rdfs:label ?name."+
          "?s geo:lat ?lat."+
          "?s geo:long ?long."+

          "FILTER ( lang(?name) = 'en' )}";
      
      //クエリを実行して、JSONを変数に入れる

      $(document).ready(function(){
        d3sparql.query(endpoint,sparql,init);
      });
    
      

    //地図部分

    function init(HeritageList) {
            console.log(HeritageList['results']['bindings'])
             
            //ズームコントロールを非表示で地図を作成
            var map = L.map('mapcontainer', { zoomControl: false });
            map.setView([35.40, 136], 5);
            L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png', {
                attribution: "<a href='https://maps.gsi.go.jp/development/ichiran.html' target='_blank'>地理院タイル</a>"
            }).addTo(map);
            //スケールコントロールを最大幅200px、右下、m単位で地図に追加
            L.control.scale({ maxWidth: 200, position: 'bottomright', imperial: false }).addTo(map);
            //ズームコントロールを左下で地図に追加
            L.control.zoom({ position: 'bottomleft' }).addTo(map);
            
            //for文でHeritageListを回す

            for (var site in HeritageList['results']['bindings']){
              
              //世界遺産のリストからマーカーを追加
              var name = HeritageList['results']['bindings'][site]['name']['value'];
              var lat = HeritageList['results']['bindings'][site]['lat']['value'];
              var long = HeritageList['results']['bindings'][site]['long']['value'];
              L.marker([lat,long],{title:name}).addTo(map);
            }

      //地図部分終了

    }
    </script>

    
  </head>

  <body onload="init()">



    <div id="mapcontainer" style="position:absolute;top:0;left:0;right:0;bottom:0;"></div>
  </body>
</html>

